# RiskOracle: 一种分钟级别的城市交通事故范围预测框架



## 摘要

实时交通事故预测对于公共安全和城市管理（例如，实时安全路线规划和应急响应部署）越来越重要。以往的事故预测工作通常是利用现有的神经网络，并只考虑静态区域相关性，在小时的级别上进行的。然而，由于道路网络的高度动态性和一个训练样本中事故记录的固有稀缺性，导致预测结果存在偏差和零膨胀问题，因此当预测步骤的粒度提高时，仍然是一个挑战。在这项工作中，我们提出了一个新的框架RiskOracle，以将预测粒度提高到分钟级别。具体来说，我们首先转换标签中的零风险值，以适应训练网络。然后，我们提出了差分时变图神经网络（DTGN）来捕捉交通状态的即时变化和动态分区间相关性。此外，我们采用多任务和区域选择方案，突出全市最有可能发生事故的分区，弥合偏差风险值和偶发事故分布之间的差距。在两个真实数据集上的大量实验证明了我们的RiskOracle框架的有效性和可扩展性。



## 介绍

交通事故预测对城市安全具有重要意义。例如，根据统计数据（Tennessee model 2017），随着田纳西州事故预测模型的部署，2016年田纳西州的死亡率降低了8.16%。越来越多的人要求以更精细的粒度进行事故预测，从而为驾驶者提供更及时的安全路线建议，并为交通智能和自动驾驶等新兴应用提供准确的应急响应。

关于事故预测周期的长度，现有的交通事故预测任务分为两部分，长期（日级预测）和中期（小时级预测）。我们在表1中总结了所有这些相关工作。尽管最近的研究侧重于日水平预测（Chang 2005；Yuan，Zhou，and Yang 2018；Tennessee model 2017)，通过对时空异构数据进行建模，使其生效，并且（Yuan, Zhou, and Yang 2018）达到了最先进的性能，这对于紧急情况来说意义不大。

小时级别的中期事故预测可进一步分为经典学习和基于深度学习的方法。经典的学习模型包括基于聚类（Anderson 2009）、基于频繁树（Lin 2015）和基于非负矩阵分解（Chen et al. 2018c）的方法。不幸的是，这种方法忽略了时间关系，无法模拟复杂的非线性时空相互作用。基于深度学习的方法，如（Ren et al.2018）利用LSTM层来学习时间关系，只将历史交通事故记录输入训练网络，而训练网络缺乏多源实时交通输入来支持预测，导致预测性能不理想。已有研究（Chenet al. 2016；2018a；Bao 2019）分别通过现有的深度学习框架SDAE、SDCAE和CONVLSM，通过结合实时人类活动来调查事故模式。然而，它们都未能提取整个城市中随时间变化的区域间和区域内相关性。

尽管深度学习模型的最新进展在小时级事故预测方面取得了有希望的结果，但我们认为，三个重要问题在很大程度上被忽视，导致在分钟级事故预测方面表现不佳。首先，如（Bao 2019）所述，当预测任务的时空分辨率提高时，将出现零膨胀问题，即所有结果预测为零。如果没有任何策略来处理这个问题，训练数据中较少的非零项会使模型无法生效（Wang et al. 2018a）。其次，尽管可以通过卷积神经网络（CNN）（Chen et al.2018a；Bao 2019）学习静态子区域相关性的程度，但时变子区域相关性在全市短期事故预测中也起着至关重要的作用，也就是说，由于潮汐流，两个子区域往往在上午强相关，下午相关性较小。第三，相邻时间间隔内同一分区内交通状况的异常变化通常会导致事故或其他事件的发生（Chen et al. 2018b; Zheng, Zhang, and Yu 2015）。在不考虑上述时空问题的情况下，之前的小时级预测模型性能将大大减小。

<div align="center">表1：交通事故预测方法总结</div>

![image-20220414154640479](https://kinvy-images.oss-cn-beijing.aliyuncs.com/Images/image-20220414154640479.png)

本文提出了基于多任务差分时变图卷积网络（Multi-task DTGN）的三阶段框架RiskOracle，研究了城市交通事故的分层次预测问题。在数据预处理阶段，我们提出了一种最大限度地推断全局交通状况的协同感知策略，然后设计了一种基于先验知识的数据增强方法来解决短期预测的零膨胀问题。在训练阶段，我们提出了多任务DTGN，其中时变总体亲和力明确地建模了短期动态子区域的相关性，差分特征生成器在交通状态的即时变化和事故之间建立了高层关系。众所周知，城市中的事故和交通量往往分布不均衡，因此多任务方案旨在解决事故预测中的空间异质性问题。在预测阶段，我们可以利用学习到的多尺度事故分布来获得一组离散的最可能子区域。在两个数据集上的实验表明，我们的框架在30分钟和10分钟级别的预测任务上都超过了最先进的解决方案。



## 前置知识和问题定义

在这一部分中，我们给出了预备知识和基本定义，然后定义了本文研究的问题。在我们的工作中，我们发现，如果直接将整个研究区域建模为一个整体方形区域，并采用传统的CNN进行时空特征提取，尤其是用于实时事故预测，会导致不必要的冗余，因为城市轮廓通常是不规则的。如图2（a）所示，我们首先将道路网内的研究区域划分为q个中型矩形区域（简称矩形区域）。每个矩形区域由几个小型方形子区域（简称子区域）组成。研究区域内共有m个子区域，我们通过城市图对m个子区域进行建模。

***定义1 （Urban Graph.)*** 研究区域可以定义为一个无向图，称为城市图$G(\mathcal{V},\mathcal{E})$。节点集合 $V={v_1，v_2,\dots,v_m}$，其中 $v_i$ 表示第 $i$ 个方形城市分区。给定两个节点 $v_i,v_j$ , 连边 $e_{ij}\in \mathcal{E}$ 表示这两个子区域的之间的联通性，其中
$$
e_{ij}=
\begin{cases}
1, & \text {iff the traffic elements within two }\\ 
&\text{subregions have strong correlations} \\
0, & \text{otherwise}
\end{cases}
$$
注意，在本文中，节点的交通元素包括两个方面，静态道路网络特征和动态交通特征。我们保持整个城市图的 $\rho$ 连通性，以控制亲和矩阵$\mathcal{A}_s$和$\mathcal{A}_o^{\Delta t}$（在nenx部分中介绍）的稀疏性，那么亲和矩阵中相应的非零项指的是具有强相关性的子区域。在特定时间间隔 $\Delta t$ 内，子区域 $v_i$ 的动态交通特征可由三部分建模：（a）人类活动强度，以交通量 $TV_{v_i}(\Delta t)$ 表示；（b） 交通状况，由平均交通速度 $a_{v_i}(\Delta t)$ 表示；和（c）交通事故风险水平 $r_{v_i}(\Delta t)$ 。动态交通特征的形式定义如下。

***定义2 （静态路网特征)***对于一个子区域节点 $v_i \in \mathcal{V}$ , 静态路网特征包括道路车道数、道路类型、路段长度和宽度、除雪优先级和高架电子标志数量的统计空间属性，对于子区域内的所有路段，可表示为固定长度向量 $s_i$。整个城市区域的静态道路网特征可以表示为 $S=\{s_1, s_2,\cdots, s_m\}$ 。

***定义3 （动态交通特征)*** 对于 $v_i \in \mathcal{V}$ ,  在给定的时间段 $\Delta t$ , $v_i$ 的动态交通特征可表示为 $f_{v_i}(\Delta t)=\{TV_{v_i}(\Delta t), a_{v_i}(\Delta t), r_{v_i}(\Delta t) \}$ .  $r_{v_i}(\Delta t)$ 所有事故的严重程度的加权总和。特别地，$r_{v_i}(\Delta t)=\sum_{j=1}^3 j * \tau_{v_i}^{\Delta t}(j)$,  其中 $j$ 表示事故严重程度的类型， $\tau_{v_i}^{\Delta t}(j)$ 表示 $j$ 类事故的数量。因此，$\Delta t$内整个城市区域的事故风险分布和动态交通特征可以用 $\mathcal{R}(\Delta t)=\{r_{v_1}(\Delta t), r_{v_2}(\Delta t),\cdots,r_{v_m}(\Delta t) \} $  和 $ \mathcal{F}(\Delta t)=\{f_{v_1}(\Delta t),f_{v_2}(\Delta t),\cdots,f_{v_m}(\Delta t),  \}$ 分别表示。

***定义4 （交通事故预测)*** 给定静态路网特征 $\mathcal{S}$  和历史动态交通特征$\mathcal{F}(\Delta t)(\Delta t=1,2,\dots T)$，我们的目的是预测全市交通事故风险 $\mathcal{R}(T+1)$ 的分布，并为未来时间间隔 $T+1$ 选择高风险子区域 $ \mathcal{V}_{acc}(T+1) $。



## 分钟级实时交通事故预测

在本节中，我们首先展示了我们提出的框架RiskOracle的概述，然后详细介绍了每个阶段。

![image-20220414162655359](https://kinvy-images.oss-cn-beijing.aliyuncs.com/Images/image-20220414162655359.png)

<div align="center" > 图1：RiskOracle 总体框架</div>

### 框架概述

如图1所示，我们提出的框架RiskOracle包括三个阶段：数据预处理阶段、模型训练阶段和预测阶段。

### 数据预处理

#### 解决事故预测中的空间异质性

高风险值往往偏向城市地区，因为大多数事故和交通量都覆盖在市中心，导致风险的严重空间不平衡，忽略了农村地区相对高风险的区域。为了在全市范围内进行预测，有必要选择最有可能发生事故的区域，并解决空间异质性问题。因此，如图2（a）所示，在我们的工作中，子区域是分层组织的，它们分别负责收集细粒度和粗粒度事故分布。然后，每个中型矩形区域中的子区域将进一步单独突出显示。多尺度分布可以看作是分级事故分布。



![image-20220414154831296](https://kinvy-images.oss-cn-beijing.aliyuncs.com/Images/image-20220414154831296.png)

<div align="center">图2：NYC的例子</div>

#### 解决零通胀问题

深度神经网络（DNNs）存在零膨胀问题，如果训练标签中的非零项非常少，则会预测无效结果（Wang et al. 2018a; Bao 2019）。如图2（b）所示，在纽约市（NYC）选定的10分钟时间间隔内，整个研究区域仅发生6起事故，表明短期事故的固有罕见性。为了解决实时事故预测中的这一问题，我们设计了一种基于先验知识的数据增强（PKDE）策略来识别训练数据集标签中的风险值。具体来说，对于区间$ \Delta t$，我们将 $\mathcal{R}(\Delta t)$ 中的零项转换为负值。转换分两个阶段进行：a）通过等式（2）将零值转换为事故风险指标；b） 指标值通过公式（3）转换为统计事故强度。给定子区域 $v_i$，我们可以通过以下公式计算其事故风险指标 $\varepsilon_{v_i}$ ：
$$
\varepsilon_{v_i}=\frac{1}{N_{week}}\sum_{j=1}{N_{week}}
\frac{r_{v_i}(j)}{\sum_{k=1}^{m}}r_{vk}(j)
$$
其中 $N_{week}$ 是训练数据集中的总周数，$r_{v_i}(j)$ 表示第$j$ 周所有时间间隔内区域 $v_i$ 的总风险值。然后，我们可以通过以下公式计算区域  $v_i$ 的统计事故强度：
$$
\pi_{v_i}=b_1\log_2\mathcal{E}_{v_i}+b_2
$$
其中 $b_1$ 和 $b_2$ 是保持 $\pi_{v_i}$ 绝对值范围和真实风险值范围之间对称性的系数。通过0到1之间的对数变换，我们可以很容易地使变换后的数据具有识别性，并适用于训练网络。转换的实施方式如下：1）零项子区域的事故强度值为负值，因此小于非零项子区域的值，反映了零项子区域事故风险较低的事实；2） 事故风险指数较低的分区事故概率较低，保留了实际事故风险等级。

#### 补充稀疏的传感数据

实时交通信息通常难以充分收集到以进行事故预测(Wang et al. 2018b)，但是，动态交通信息往往与静态空间路网结构具有交互作用(Geng et al. 2019; Lin 2015)。 因此，我们通过利用因子分解机（FM）的交互操作将xDeepFM(Lian et al. 2018)修改为适合交通数据的时空深度分解机（ST-DFM），提出了一种协同感知策略。

我们首先通过静态亲和矩阵提取子区域之间的道路网络相似性和连接，其中 $\mathcal{A}_s$ 中的项$\alpha_{\mathcal{s}}(i,j)$ 表示子区域 $v_i$ 和 $v_j$ 内的静态亲和性，亲和性可通过以下公式计算：
$$
\alpha_{\mathcal{s}}(i,j)=
\begin{cases}
1, & \text {if subregion vi and}\\ 
& v_j \ \text {are adjacent} \\
e^{-JS(\mathcal{s}_i\rVert \mathcal{s}_j)}, & \text{otherwise}
\end{cases}
$$
这里，$JS$ 函数是Jensen-Shannon散度(Lin 1991):
$$
JS(\mathcal{s}_i\lVert\mathcal{s}_j)=\frac{1}{2}\sum_k
(\mathcal{s}_i(k)\log\frac{2\mathcal{s}_i(k))}{\mathcal{s_i}(k)+\mathcal{s}_j(k)}
+ \mathcal{s}_j(k)\log\frac{2\mathcal{s}_j(k))}{\mathcal{s_i}(k)+\mathcal{s}_j(k)})
$$
与xDeepFM相同，ST-DFM包含压缩交互网络（CIN）模块和DNN模块。ST-DFM中嵌入了三个时空域，即静态空间特征、动态交通特征和时间戳。然后，ST-DFM利用CIN模块在向量级学习不同时空特征之间的交互关系，利用DNN模块学习特征的高层表示，最终得到高层特征组合。我们通过将相应子区域的交通量输入ST-DFM来推断速度值，反之亦然。然后，通过在两个实时交通数据集的交叉口内训练数据，可以最大限度地推断交通信息，以获得全局交通状态。



### 交通事故预测的多任务DTGN

#### 时空DTGN

交通事故和拥堵往往会在道路网络中相互影响和传播，尤其是在节假日或高峰时段。由于GCN在建模非欧几里德分区传播和相关性方面的潜力（(Geng et al. 2019），我们在此提出DTGN。我们通过结合时变整体亲和力和差分特征生成器来修改GCN，以应对分钟级事故预测中的挑战。

#### 包含动态流量特征的时变整体关联矩阵

已经证明，不同城市分区的交通状况之间存在强烈的时变相关性（Wang et al. 2017; 2014）。此外，交通事故和城市交通状况之间存在很强的时空相关性（Chen et al. 2018b）。因此，对于我们的分钟级事故预测，必须通过整体亲和矩阵 $\mathcal{A}_o^{\Delta t}$ 捕捉特定时间间隔 $\Delta t$ 的分区间时变交通相关性。$\mathcal{A}_o^{\Delta t}$  中的项 $\alpha_o^{\Delta t}(i,j)$ 表示子区域 $v_i$ 和 $v_j$ 内的动态总体亲和力：
$$
\alpha_o^{\Delta t}(i,j)=e^{-JS(\mathcal{s}_i^*\lVert\mathcal{s}_j^*)}
+\gamma * e^{-JS(C_i^{\Delta t}\lVert C_j^{\Delta t})}
$$
$C_j^{\Delta t}$ 包括上周每天在同一时间间隔  $\Delta t$ 内第 $v_i$ 分区的交通量 $TV_{v_i}(\Delta t)$ 和平均速度$a_{v_i}(\Delta t)$。请注意，我们使用基于注意力的方案（Bahdanau, Cho, and Bengio 2014），根据子区域对事故的不同影响，修改了子区域静态空间属性的权重。此外，子区域 $v_i$ 基于事故的静态特征可以表示为 $s_i^∗$ . 此外，使用加权因子 $\gamma$ 来调整动态交通条件亲和性占整体亲和性矩阵的比例。有了这样的整体亲和力，由于交通特性而具有潜在事故相关相关性的遥远分区也可以动态连接。为了在空间域使用GCN，我们需要用 $\mathcal{A}_o^{\Delta t}$ 计算拉普拉斯矩阵 $L^{\Delta t}$ , 这可以看作是图邻接矩阵。首先，得到 $\mathcal{B}^{\Delta t}$:
$$
\mathcal{B}^{\Delta t} = \mathcal{A}_o^{\Delta t} + I_m
$$
其中中，$I_m$ 是 $m\times m$ 的单位矩阵。第二，我们计算 $\Phi ^{\Delta t}$
$$
\Phi ^{\Delta t}=
 \begin{bmatrix} 
 \varphi_{11} & 0 & \cdots & 0\\ 
 0 & \varphi_{22} & \cdots & 0\\ 
 \vdots & \vdots & \ddots & \vdots \\
 0 & 0 & \cdots & \varphi_{mm}
 \end{bmatrix}
$$
其中 $\varphi_{ii}=\sum_{j=1}^mb_{ij}$ , $b_{ij}$ 是矩阵 $\mathcal{B}^{\Delta t}$ 的元素，然后，我们可以通过以下公式获得 $\Delta t$的拉普拉斯矩阵
$$
L^{\Delta t}=({\Phi^{\Delta t}})^{-\frac{1}{2}}\mathcal{B}^{\Delta t}
(\Phi^{\Delta t})^{-\frac{1}{2}}
$$

#### 用于时空特征提取的差分GCN

人们普遍认为，与常规交通条件相比，事故或事件预测任务与城市交通条件的异常变化更相关（Chen et al. 2018b; Zheng, Zhang, and Yu 2015）。为此，我们引入了一个差分特征生成器来计算相邻时间间隔内的差分图像。通过将差分动态交通特征输入到GCN中，可以模拟交通异常变化的传播和相互作用，并学习即时交通状态变化与事故之间的高级关联，尤其有利于分钟级事故预测。给定 $\Delta t$,  差分向量 $\overrightarrow{\Theta}^{\Delta t}$ 的计算
$$
\overrightarrow{\Theta}^{\Delta t} =
\mathcal{D}(\Delta t)-\mathcal{D}(\Delta t -1)
$$
其中 $\mathcal{D}(\Delta t)=\{d_{v_1}(\Delta t),d_{v_2}(\Delta t), \cdots, d_{v_m}(\Delta t)\}$ , $d_{v_i}(\Delta t)=\{TV_{v_i}, a_{v_i}(\Delta t)\}$. 对于 $\Delta t$ 中的所有子区域，通过将其动态流量特征和相应的差分向量相结合，我们生成一个统一的特征元组 $\mathcal{U}(\Delta t)=\{\mathcal{F}(\Delta t),  \overrightarrow{\Theta}^{\Delta t}\}$ . 如（Zhang, Zheng, and Qi 2017）所述，城市交通具有明显的三个时间角度的特征，即小时接近性、日周期性和远距离趋势。为此，当给定 $\Delta t$ 时，我们为每个时间透视图选择κ联合特征元组作为DTGN的输入。具体来说，我们选择 $\Delta t$ 的最后一个 $k$ 间隔，从每小时接近度和每日周期的角度来看，该间隔与最后一个连续 $k$ 天的 $\Delta t$  相同。对于远距离趋势，我们首先以每10天的频率选择 $k$ 前几天，对于每个$k$ 前几天，我们提取与$\Delta t$  相同的间隔。如图1所示，我们然后将所有三个时间透视图的统一特征元组集独立地输入DTGN。一个DTGN的详细架构如图3（a）所示。对于一个特定的时间，我们将相应的联合特征元组集表示为 $\mathbb{U}_*^{\Delta t }$.

![image-20220414174402180](https://kinvy-images.oss-cn-beijing.aliyuncs.com/Images/image-20220414174402180.png)



<div align="center">图3：多任务DTGN的详细信息 </div>



我们将 $\mathbb{U}_*^{\Delta t }$ 放入到一个全连接网络中，将所有特征编码到低维特征集中，然后再将它放入到一个GCN中，GCN循环迭代
$$
\mathcal{H}^{n+1}=\text{Leaky\_ReLU}(L*\mathcal{H}^n\mathcal{W}^n)\ 
\text{where}\ \mathcal{H}^0 = \mathbb{U}_*^{\Delta t}
$$
这里 $\mathcal{H}^n $ 表示第 $n$ 层图卷积，$\mathcal{W}^n$ 表示第 $n$ 层图卷积核的权重。注意这里，给定一个时间透视图，我们将所有选定时间间隔的 $L^{\Delta t}$ 矩阵的平均值取为 $L^∗$. 我们在每两个GCN层之间使用Batch规范化，以避免梯度爆炸。考虑到我们转换的数据集中的负值，我们选择Leaky ReLU作为激活函数。此外，实时动态外部因素，即时间戳和气象数据，被连续嵌入到固定长度的向量中，然后与每个GCN单元的输出进行融合。对于三个时间透视图，我们将DTGN的输出特征图分别表示为 $\mathcal{O}_{hc}^{\Delta t},\mathcal{O}_{dp}^{\Delta t}, \mathcal{O}_{dt}^{\Delta t}$.

### 事故风险预测的多任务学习

在本小节中，我们设计了多任务方案，不仅增强了深度表示，还学习了分层事故分布，并为大多数类似事故区域的选择提供了指导。为了预测次区域的事故风险，我们首先以事故风险分布为主要任务。考虑到交通事故与人类活动强度之间的显著相关性，我们将区域交通量预测作为第一辅助任务来增强代表性。为了为分级事故区域选择提供指导信息，我们将不同矩形区域内的事故总数作为第二个辅助任务。

具体来说，我们将DTGN的输出特征映射（包括$\mathcal{O}_{hc}^{\Delta t},\mathcal{O}_{dp}^{\Delta t}, \mathcal{O}_{dt}^{\Delta t}$）输入到基于卷积的融合模块中，如图1所示，然后执行多任务学习。我们在图3（b）中展示了多任务方案的流程图。首先，我们生成预测的风险分布特征图 $\mathcal{O}_{risk}^{\Delta t}$ 和全市交通量 $\mathcal{O}_{vol}^{\Delta t}$ 如下所示，我们在主任务中选择Leaky_ReLU的原因是因为标签中的风险部分转化为负值，其他任务保持非负值。
$$
\mathcal{O}_{risk}^{\Delta t}=\text{Leaky\_ReLU}
(\mathcal{W}_{risk}^{\Delta t} * 
[\mathcal{O}_{hc}^{\Delta t},\mathcal{O}_{dp}^{\Delta t}, \mathcal{O}_{dt}^{\Delta t}])
$$

$$
\mathcal{O}_{vol}^{\Delta t}= \text{ReLU}
(\mathcal{W}_{vol}^{\Delta t} * 
[\mathcal{O}_{hc}^{\Delta t},\mathcal{O}_{dp}^{\Delta t}, \mathcal{O}_{dt}^{\Delta t}])
$$

通过额外的全连接层，我们可以通过以下方式了解每个矩形区域内的事故总数：
$$
\mathcal{O}_{count}^{\Delta t}= \text{ReLU}
(\mathcal{W}_{fc}^{\Delta t} * ( \mathcal{W}_{count}^{\Delta t} *
[\mathcal{O}_{hc}^{\Delta t},\mathcal{O}_{dp}^{\Delta t}, \mathcal{O}_{dt}^{\Delta t}]))
$$
这里 $\mathcal{W}_{risk}^{\Delta t},\mathcal{W}_{vol}^{\Delta t},\mathcal{W}_{count}^{\Delta t}$  分别表示在时间段 $\Delta t$ 事故风险、人类活动强度和不同中矩形区域内事故数量的融合权重。$\mathcal{W}_{fc}^{\Delta t}$ 是全连接网络的融合权重。$\mathcal{O}_{count}^{\Delta t}$ 可以看作是粗粒度的事故分布，它将被输入到另一个全连接层中，映射到与 $\mathcal{O}_{risk}^{\Delta t}$ 相同的形状，然后与事故风险分布特征映射 $\mathcal{O}_{risk}^{\Delta t}$ 的输出集成，迫使两个任务充分了解多个事故分布之间的关系。然后 $\mathcal{O}_{risk}^{\Delta t}$ 可以通过下式计算得到：
$$
\mathcal{O}_{risk*}^{\Delta t}=\text{Leaky\_ReLU}
(\mathcal{W}_{fc*}*\mathcal{O}_{count}^{\Delta t}+
\mathcal{O}_{risk}^{\Delta t})
$$
其中 $\mathcal{O}_{risk*}^{\Delta t}$ 是主任务的最终输出，$\mathcal{W}_{fc*}$  表示全连接层的权重。因此，这个多任务学习框架的 $Loss$ :
$$
\text{Loss}(\theta)=mse_{risk*}+\lambda_1*mse_{vol}+\lambda_2*mse_{count}+ 
\lambda_3*L_2
$$
其中 $mse_{risk*}, mse_{vol}, mse_{count}$ 分别是主任务，两个辅助任务的 loss.  我们使用L2正则化来避免过度拟合问题,使用 $λ_1、λ_2、λ_3$ 作为损失函数的超参数。



### 事故区域最可能的等级选择

在一个特定的城市中，农村和城市地区的事故和交通量往往存在不平衡的数量，导致了空间异质性问题。因此，用一个统一的风险阈值来选择最有可能发生事故的分区是不合逻辑的。然后，我们提出了一种基于在多任务方案中学习到的分层事故分布的分层最可能事故区域选择（HARS）策略。

对于每个矩形区域 $i$，我们选择风险最高的子区域 $k_i(i=1,2,\cdots,q)$，参数 $k_i$ 等于第二个辅助任务学习到的 $\mathcal{O}_{count}^{\Delta t}$  中的相应元素。因此，我们得到了一组最相似的事故区域。此外，学习的 $k_i$ 减少了过度预测的区域，并使模型在涉及外部因素的情况下，与时间和天气的变化保持一致。



## 实验

在本节中，我们通过将时间间隔设置为30分钟和10分钟来进行广泛的实证研究，以评估我们的分钟水平预测框架。



### 数据描述

我们在两个真实数据集上进行了实验：纽约市开放数据集（NYC）和苏州工业园区（SIP）数据集。对于纽约数据集，由于缺乏实时交通量，我们在这里使用每个分区的出租车出行量作为人类活动的指标。对于SIP数据集，它包含流量和速度。我们将其与另一个从微博收集的交通事故数据集整合。统计数据如表2所示。更多详细信息请访问网站。

<div align="center">表2：数据集</div>

![image-20220414195631546](https://kinvy-images.oss-cn-beijing.aliyuncs.com/Images/image-20220414195631546.png)



### 实现细节

对于实验，我们分别选择60%、30%和10%的数据集进行训练、评估和验证。我们通过参考常见设置（Geng et al. 2019）和实践，将城市地图划分为大小相等的小分区，从而生成分区集 $V$。我们堆叠了9个GCN层，每层384个过滤器。损失函数的权重设置为$λ_1=0.8、λ_2=1、λ_3=1\text{e}-4$. 多任务DTGN采用反向传播和Adam方法（Kingma 2014）进行训练。

在训练期间，将动态交通数据和关联矩阵聚合为3组，并将两个尺度的事故分布输入多任务DTGN。为了进行测试，我们获取所需的数据并将其传递给模型，通过主任务和第二辅助任务导出大多数类似的事故子区域。在同一时空范围内，突出显示高风险次区域，并与真实世界的事故记录进行比较

### 评估指标

我们从回归和分类两个角度来评估我们提出的风险。（1） 回归角度：预测风险的均方误差（MSE）。（2） 空间分类视角：a）前M的准确性(Acc@M）（Liao et al. 2018），这项广泛应用于时空排序任务中，表明了M个最高风险区域内的准确预测百分比。根据统计数据（2017年纽约市事故记录），在纽约数据集中30分钟和10分钟的评估中，M分别等于20和6。同样，在SIP数据集中，M等于5。b）Acc@K，其中K是第二个辅助任务学习到的$k_i$的总和。请注意，Acc1表示事故发生频率高的小时内的准确度，例如上午7:00-9:00和下午12:00-4:00。

### 基准

以下是五条基准：（1） **ARIMA**是一种经典的机器学习算法，用于理解和预测未来值，尤其是时间序列预测；（2） **Hetero ConvLSTM**，最先进的交通事故预测深度学习框架（Yuan, Zhou, and Yang 2018）；（3） **ST ResNet**，于（Zhang, Zheng, and Qi 2017）提出，用于预测交通流量；（4） **SDAE**，在（Chen et al. 2016）中提出，通过结合人类活动性进行实时风险预测；（5） **SDCAE**，在（Chen et al. 2018a）中提出的全市小时级事故风险预测的最新方法。

### 评价结果与分析



#### 性能比较

表3显示了30分钟和10分钟间隔设置下纽约和SIP数据集的性能比较。令人鼓舞的是，我们的框架RiskOracle实现了最高的准确性，在几乎所有指标上都优于基线。利用HARS，我们的模型通过突出第 $i$ 个矩形区域中的 $k_i$ 子区域，解决了事故预测中的空间异质性和过度预测问题。特别是在纽约市数据集上，我们的RiskOracle将准确率提高了22.49%，相比于Acc@20.因此，RiskOracle对事故更为敏感，可扩展为稀疏传感数据以及短期零星时空预测。此外，它表明，我们的模型在高风险时段表现更好，这是事故预测的实际应用所期望的。NYC的性能优于SIP数据集的原因可能是SIP中事故标签的不完整。我们将报告Acc@K后来在消融研究中。

<div align="center"> 表3：NYC和SIP数据性能比较</div>

![image-20220414201407970](https://kinvy-images.oss-cn-beijing.aliyuncs.com/Images/image-20220414201407970.png)

总的来说，随着时间粒度变得更细，我们框架的性能略有下降，而基线陷入零膨胀问题时，性能急剧下降，这表明了我们提出的短期事故预测方案的有效性和可扩展性。这两个数据集的改进验证了我们提出的RiskOracle的健壮性和通用性，即使在实际应用中的数据集包含罕见的事故记录。

#### 评估Acc@K和消融研究

在表4中，我们研究了Acc@K，这是我们在论文中提出的。我们记录每个时间间隔的$K$，这是我们的公平比较框架学习到的 $k_i$ 的总和。这是合理的结果Acc@20和Acc@6略高于Acc@K因为统一的阈值不能适应实时条件，并且容易高估事故。相比之下，我们的框架具有灵活性，可以通过多尺度事故分布预测来近似每个矩形区域的事故数量。正如所观察到的，我们的框架可以超越其他基线，并在以下方面达到可接受的精度水平：Acc@K当与表3中的结果进行比较时，验证我们的分级事故选择机制在任务中的有效性。







![image-20220414201927333](https://kinvy-images.oss-cn-beijing.aliyuncs.com/Images/image-20220414201927333.png)

<div align="center">表4： 在NYC数据集的消融实验</div>

此外，为了研究每种成分对高质量结果的贡献，我们进行了一项消融研究，以区分RiskOracle的哪些成分对其成功最重要。RiskOracle烧蚀变体的预测性能如纽约数据集上的表4所示。RO-1到RO-5代表了从集成风险管理系统中依次删除以下模块的变体：Oracle、PKDE策略、ST-DFM、整体关联性、差异特征生成器和HARS的多任务。在30分钟和10分钟的水平上，集成模型始终优于其他车型。具体而言，随时间变化的整体亲和力和PKDE策略有助于最显著的促销。根据表4，我们可以得出结论，精心设计的组件确实会显著改善短期预测。

### 超参数研究

这里我们展示了NYC 30分钟级的参数研究。我们调整每层中的层数和过滤器，以达到9层384个过滤器的最佳性能。我们将主要任务的权重固定为1，并调整$λ_1，λ_2$，Acc@K当 $λ_1=0.8$ 和$λ_2=1$时，达到最高53.82%。此外，我们还调整了动态元素在整体亲和力中的权重，并在$\{0,0.5,1.0,1.2,1.5\}$中 $γ$ 等于0.5时达到最佳性能。当第二个辅助任务的MSE达到最低值时，q等于$\{9,18,33\}$中的18。请注意，我们的框架是离线训练的，学习的参数用于在线预测。计算量可由参数确定，并在几秒钟内完成，充分满足实时预测的要求。

### 案例研究

图4显示了RiskOracle在选定的30分钟间隔内预测的事故。总体而言，RiskOracle生成的全市风险地图显示了区分不同的风险，显示的子区域与真实的数据非常相似。在这里，由于周日早上很少有人出门，所以早上7点预测的事故很少。然而，当下午来临时，事故的数量会增加，到了晚上，情况会变得更糟。主要是因为当晚的大雨，造成了容易发生事故的路况。结果表明，辅助任务和HARS通过捕获带有外部因素的事故分布的动态模式来学习相应地调整推理，这比统一阈值解具有更好的适应性。

<img src="https://kinvy-images.oss-cn-beijing.aliyuncs.com/Images/image-20220414202958715.png" alt="image-20220414202958715"  />

<div align="center">图4：RiskOracle 在NYC 2017年5月22日的预测结果 </div>



## 结论

本文提出了基于多任务DTGN的综合框架RiskOracle，为城市安全提供了更及时的量化决策依据，从而解决了城市交通事故精细级预测面临的挑战。我们首先提出了两种策略来克服零膨胀问题和稀疏感知。通过在多任务DTGN中加入差分特征生成器和时变整体亲和力，我们的框架能够对零星的时空数据进行建模，并捕获短期的分区相关性。我们还强调了最可能的事故区域，以处理多任务方案中具有可学习的多尺度事故分布的空间异质性。在两个真实世界的数据集验证我们的框架优于最先进的解决方案。因此，我们的工作可以成为解决时空数据挖掘任务的范例，这些任务具有零星的标签和不足的传感数据，例如对犯罪和疫情暴发的预测。



## 致谢

本文由安徽省杰出青年科学基金（No.8080JJ24）、国家自然科学基金（616724861772492）、江苏自然科学基金（BK20171240、BK20191193）、CAS百强人才计划等部分资助。





























